<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Read YAML</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>    
    <script src="scripts/js-yaml.js"></script>
    <script type="text/javascript">
        $(function() {
            $.get( 'decision-tree-uu.yaml', function( data ) {
                var info = jsyaml.load( data );
                console.log( questions );

                qcontainer = $( "#questions");
                info.input.forEach(element => {                    
                    var squestion = $("<div>", { class: "storage-question", text: element["question"] });
                    var qdiv = $("<div>", { class: "storage-questions"}).append(squestion);
                    if (element["info"]) {
                        var tooltip = "#tooltip-" + element["id"]
                        console.log("info present");
                        squestion.append( 
                            $("<a>", { rel: "popover", "data-content": element.info, class: "info-icon", "data-html": true })
                                .append( $("<img>", { src: "assets/info-button.svg"})));
                        qdiv.append( $("<div>", { id: tooltip, class: "hide", html: element["info"] }));
                    } else {
                        console.log("no info");
                    }
                    var selectortype ;
                    if (element.multi) {
                        selectortype = "checkbox";
                    } else {
                        selectortype = "radio";
                    }
                    element.answers.forEach(answer => {
                        console.log(answer);
                        var id = answer["value"];
                        var input = $("<input>", { name: "question-" + element.id, type: selectortype, value: answer["value"], class: 'data-answers' });
                        input.data( { excludes: answer.excludes })
                        var label = $("<label>", { for: id });                             
                        qdiv.append( $("<span>").append(label.append(input)));
                        label.append(answer["value"]);
                    });
                    qcontainer.append(qdiv);
                });

                scontainer = $( "#solutions");
                info.solutions.forEach(element => {
                    var sid = "solution-" + element.id;
                    var sdiv = $("<div>", { class: "solution"});
                    sdiv.append($("<div>", { class: "heading"})
                        .append($("<h4>", { html: element.name}))
                        .append($("<p>", { html: element.infoline})));

                    scontainer
                        .append($("<div>", { class: "tool panel panel-default", id: sid})
                            .append($("<a>", { "data-toggle": "modal", "data-target": "#" + sid + "-info"})
                                .append(sdiv)));
                    scontainer.append($("<div>", { class: "modal  fade", id: sid + "-info", role: "dialog" })
                        .append($("<div>", { class: "modal-dialog modal-lg"})
                            .append($("<div>", { class: "modal-content"} )
                                .append($("<div>", { class: "modal-header", text: element.name }))
                                .append($("<div>", { class: "modal-body", html: element.info  }))
                                .append($("<div>", { class: "modal-footer", html: element.description })))));
                });
                $('[rel="popover"]').popover();

                $('body').on('click', function (e) {
                    $('[rel="popover"]').each(function () {
                    //the 'is' for buttons that trigger popups
                    //the 'has' for icons within a button that triggers a popup
                        if (!$(this).is(e.target) && $(this).has(e.target).length === 0 && $('.popover').has(e.target).length === 0) {
                            $(this).popover('hide');
                        }
                    });
                });

                $('input').on('change', function (e) {
                    console.log('event',e);
                    $(".tool").removeClass('greyed-out');
                    $('input.data-answers').each(function( index ) {
                        var ielt = $(this)
                        //console.log( index + ": ", ielt );
                        //console.log( 'val', ielt.val());
                        //console.log( 'check', ielt.prop('checked'));
                        //console.log('data', ielt.data('excludes'));
                        var excludes = ielt.data('excludes');
                        if (excludes && ielt.prop('checked')) {
                            excludes.forEach( exclude => {
                                console.log('excluding', 'solution-' + exclude);
                                $("#solution-" + exclude).addClass('greyed-out');
                            });
                        }
                    });
                });
            });

            
        });
    </script>
    <link rel="stylesheet" href="style.css">    
    
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-4">
                <div id=questions>
                </div>
            </div>
            <div class="col-8">
                <div id="solutions"></div>
            </div>
        </div>
    </div>
</body>
</html>